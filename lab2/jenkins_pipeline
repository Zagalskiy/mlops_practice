pipeline {
    agent any
    
    stages {
        stage('Checkout') {
            steps {
                checkout([$class: 'GitSCM',
                          branches: [[name: '*/testing/lab2']],
                          doGenerateSubmoduleConfigurations: false,
                          extensions: [[$class: 'CleanBeforeCheckout']],
                          submoduleCfg: [],
                          userRemoteConfigs: [[
                              credentialsId: 'giga', // Имя учетных данных SSH-ключа
                              url: 'git@github.com:Zagalskiy/mlops_practice.git' // URL вашего репозитория GitHub
                          ]]
                ])
            }
        }
        
        stage('Build and Deploy') {
            steps {
                dir('lab2') {
                    sh 'python data_creation.py'
                    sh 'python data_preprocessing.py'
                    sh 'python model_preparation.py'
                    sh 'python model_testing.py'
                }
            }
        }
        
        stage('Archive Artifacts') {
            steps {
                archiveArtifacts artifacts: 'lab2/*', allowEmptyArchive: true
            }
        }
        
        stage('Commit and Push Changes') {
            steps {
                script {
                    sh 'git config --global user.email "jenkins@example.com"'
                    sh 'git config --global user.name "Jenkins"'
                    sh 'git add lab2/*'
                    sh 'git commit -m "Add archived artifacts"'
                    sh 'git push'
                }
            }
        }
    }
}